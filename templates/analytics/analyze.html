{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="analyze-container">
    <h1>Code Complexity Analysis</h1>
    <p>Paste your Python code below to analyze its complexity using AST (Abstract Syntax Tree)</p>

    {% if error %}
    <div class="analytics-error-message">
        <strong>‚ö†Ô∏è Error:</strong> {{ error }}
    </div>
    {% endif %}

    <form method="post" class="analytics-analysis-form">
        {% csrf_token %}

        <div class="analytics-form-group">
            <label for="source_code">Python Source Code:</label>
            <textarea
                name="source_code"
                id="source_code"
                rows="20"
                placeholder="def hello():
    return 'world'"
                required
            >{% if source_code %}{{ source_code }}{% endif %}</textarea>
            <div class="analytics-help-text">
                üí° Tip: Paste any Python code here to analyze cyclomatic complexity, function metrics, and code quality
            </div>
        </div>

        <div class="analytics-form-actions">
            <button type="submit" class="btn btn-primary">üîç Analyze Code</button>
            <a href="{% url 'analytics:home' %}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>

    <div class="analytics-examples-section">
        <h3>üìù Example Snippets</h3>
        <div class="analytics-examples-grid">
            <div class="analytics-example-card">
                <h4>Simple Function</h4>
                <pre>def hello():
    return "world"</pre>
                <button onclick="copyExample(this)" class="analytics-copy-btn">Copy</button>
            </div>

            <div class="analytics-example-card">
                <h4>Complex Function</h4>
                <pre>def complex_function(n):
    if n < 0:
        return -1
    elif n == 0:
        return 0
    else:
        for i in range(n):
            if i % 2 == 0:
                for j in range(i):
                    if j % 3 == 0:
                        print(j)
        return n</pre>
                <button onclick="copyExample(this)" class="analytics-copy-btn">Copy</button>
            </div>
        </div>
    </div>
</div>

<link rel="stylesheet" href="{% static 'css/analytics.css' %}">

<script>
function copyExample(button) {
    const pre = button.previousElementSibling;
    const code = pre.textContent;

    // Copy to clipboard
    navigator.clipboard.writeText(code).then(() => {
        // Update button text
        const originalText = button.textContent;
        button.textContent = '‚úì Copied!';
        button.style.background = '#28a745';

        // Reset after 2 seconds
        setTimeout(() => {
            button.textContent = originalText;
            button.style.background = '#007bff';
        }, 2000);
    });
}
</script>
{% endblock %}